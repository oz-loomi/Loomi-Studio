<script props>
  module.exports = {
    rooftop: props.rooftop || '',
    // Content
    sectionTitle: props['section-title'] || 'Why Service With Us',
    feature1: props.feature1 || props['feature1-title'] || '',
    feature1Icon: props['feature1-icon'] || '',
    feature1Image: props['feature1-image'] || '',
    feature1Desc: props['feature1-desc'] || '',
    feature2: props.feature2 || props['feature2-title'] || '',
    feature2Icon: props['feature2-icon'] || '',
    feature2Image: props['feature2-image'] || '',
    feature2Desc: props['feature2-desc'] || '',
    feature3: props.feature3 || props['feature3-title'] || '',
    feature3Icon: props['feature3-icon'] || '',
    feature3Image: props['feature3-image'] || '',
    feature3Desc: props['feature3-desc'] || '',
    feature4: props.feature4 || props['feature4-title'] || '',
    feature4Icon: props['feature4-icon'] || '',
    feature4Image: props['feature4-image'] || '',
    feature4Desc: props['feature4-desc'] || '',
    // Layout
    variant: props.variant || 'icon',
    iconSize: props['icon-size'] || '80',
    iconMargin: props['icon-margin'] || '0 0 12px 0',
    cardHeight: props['card-height'] || '140',
    cardPadding: props['card-padding'] || '32px',
    cardGap: props['card-gap'] || '16',
    get halfGap() { return Math.round(parseInt(this.cardGap) / 2) + 'px'; },
    get fullGap() { return this.cardGap + 'px'; },
    containerPadding: props['container-padding'] || props.padding || '',
    align: props.align || 'left',
    // Typography
    font: props.font || "Helvetica Neue, Helvetica, Arial, sans-serif",
    // Section title
    titleSize: props['title-size'] || '10px',
    titleWeight: props['title-weight'] || '700',
    titleSpacing: props['title-spacing'] || '2.5px',
    titleTransform: props['title-transform'] || 'uppercase',
    titleMargin: props['title-margin'] || '0 0 16px 0',
    // Feature title
    featureTitleSize: props['feature-title-size'] || '13px',
    featureTitleWeight: props['feature-title-weight'] || '700',
    // Feature description
    featureDescSize: props['feature-desc-size'] || '12px',
    featureDescWeight: props['feature-desc-weight'] || '400',
    featureDescLineHeight: props['feature-desc-line-height'] || '1.5',
    featureDescOpacity: props['feature-desc-opacity'] || '0.8',
    // Image variant overlay
    imageOverlay: props['image-overlay'] || 'linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 50%, rgba(0,0,0,0) 100%)',
    imageTextColor: props['image-text-color'] || '#ffffff',
    imageDescColor: props['image-desc-color'] || 'rgba(255,255,255,0.85)',
    // Computed visibility
    hasFeature1: !!(props.feature1 || props['feature1-title']),
    hasFeature2: !!(props.feature2 || props['feature2-title']),
    hasFeature3: !!(props.feature3 || props['feature3-title']),
    hasFeature4: !!(props.feature4 || props['feature4-title']),
    get hasRow2() { return this.hasFeature3 || this.hasFeature4; },
    // Colors
    cardBgColor: props['card-bg-color'] || '#ebebeb',
    cardRadius: props['card-radius'] || '0',
    cardBorder: props['card-border'] || '',
    titleColor: props['title-color'] || 'rgba(0,0,0,0.5)',
    textColor: props['text-color'] || '#000000',
    accentColor: props['accent-color'] || '',
    accentWidth: props['accent-width'] || '3px',
    // Border
    borderColor: props['border-color'] || '',
    borderWidth: props['border-width'] || '0px',
    borderStyle: props['border-style'] || 'none',
    // Per-side borders
    borderTopColor: props['border-top-color'] || '',
    borderTopWidth: props['border-top-width'] || '',
    borderTopStyle: props['border-top-style'] || '',
    borderRightColor: props['border-right-color'] || '',
    borderRightWidth: props['border-right-width'] || '',
    borderRightStyle: props['border-right-style'] || '',
    borderBottomColor: props['border-bottom-color'] || '',
    borderBottomWidth: props['border-bottom-width'] || '',
    borderBottomStyle: props['border-bottom-style'] || '',
    borderLeftColor: props['border-left-color'] || '',
    borderLeftWidth: props['border-left-width'] || '',
    borderLeftStyle: props['border-left-style'] || '',
    get borderCss() {
      const sides = [
        { s: 'top', c: this.borderTopColor, w: this.borderTopWidth, st: this.borderTopStyle },
        { s: 'right', c: this.borderRightColor, w: this.borderRightWidth, st: this.borderRightStyle },
        { s: 'bottom', c: this.borderBottomColor, w: this.borderBottomWidth, st: this.borderBottomStyle },
        { s: 'left', c: this.borderLeftColor, w: this.borderLeftWidth, st: this.borderLeftStyle },
      ];
      const perSide = sides.filter(x => x.c).map(x => ' border-' + x.s + ': ' + (x.w || this.borderWidth || '1px') + ' ' + (x.st || this.borderStyle || 'solid') + ' ' + x.c + ';').join('');
      if (perSide) return perSide;
      return this.borderColor ? ' border: ' + this.borderWidth + ' ' + this.borderStyle + ' ' + this.borderColor + ';' : '';
    },
    // Structured gradient
    gradientType: props['gradient-type'] || 'none',
    gradientAngle: props['gradient-angle'] || '',
    gradientDirection: props['gradient-direction'] || 'to bottom',
    gradientStart: props['gradient-start'] || '',
    gradientStartPosition: props['gradient-start-position'] || '0',
    gradientEnd: props['gradient-end'] || '',
    gradientEndPosition: props['gradient-end-position'] || '100',
    get gradientCss() {
      if (this.gradientType === 'none' || !this.gradientStart || !this.gradientEnd) return '';
      const startPos = this.gradientStartPosition === '' ? '0' : this.gradientStartPosition;
      const endPos = this.gradientEndPosition === '' ? '100' : this.gradientEndPosition;
      const startStop = this.gradientStart + ' ' + startPos + '%';
      const endStop = this.gradientEnd + ' ' + endPos + '%';
      if (this.gradientType === 'radial') return ' background: radial-gradient(circle, ' + startStop + ', ' + endStop + ');';
      const axis = this.gradientAngle !== '' ? (this.gradientAngle + 'deg') : this.gradientDirection;
      return ' background: linear-gradient(' + axis + ', ' + startStop + ', ' + endStop + ');';
    },
    // ── Mobile overrides (responsive) ──
    mCardRadius: props['m:card-radius'] || '',
    mPadding: props['m:padding'] || '',
    scopeClass: 'loomi-c' + (props['component-index'] || '0'),
    get responsiveCss() {
      const r = [];
      const s = '.' + this.scopeClass + ' ';
      if (this.mCardRadius) r.push(s + '.loomi-feature-card { border-radius: ' + this.mCardRadius + ' !important; }');
      if (this.mPadding) r.push(s + '.loomi-features-td { padding: ' + this.mPadding + ' !important; }');
      return r.join(' ');
    },
  };
</script>

<if condition="responsiveCss">
  <style>
    @media screen and (max-width: 600px) {
      {{{ responsiveCss }}}
    }
  </style>
</if>
<tr class="{{ scopeClass }}">
  <td class="loomi-features-td" style="text-align: {{ align }};{{ containerPadding ? ' padding: ' + containerPadding + ';' : '' }}{{ borderCss }}{{ gradientCss }}">
    <p style="font-family: {{ font }}; font-size: {{ titleSize }}; font-weight: {{ titleWeight }}; letter-spacing: {{ titleSpacing }}; text-transform: {{ titleTransform }}; color: {{ titleColor }}; margin: {{ titleMargin }};">
      {{ sectionTitle }}
    </p>
    <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
      <!-- Row 1 -->
      <tr>
        <td width="50%" class="mobile-stack" style="padding: 0 {{ halfGap }} {{ fullGap }} 0;" valign="top">
          <table class="loomi-feature-card" role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="background-color: {{ cardBgColor }}; border-radius: {{ cardRadius }};{{ cardBorder ? ' border: ' + cardBorder + ';' : '' }}{{ variant === 'image' && feature1Image ? ' background-image: ' + imageOverlay + ', url(' + feature1Image + '); background-size: cover; background-position: center;' : '' }}{{ accentColor && variant === 'image' ? ' border-bottom: ' + accentWidth + ' solid ' + accentColor + ';' : '' }}">
            <tr>
              <td style="padding: {{ cardPadding }}; height: {{ cardHeight }}px;" valign="{{ variant === 'image' ? 'bottom' : 'top' }}">
                <if condition="feature1Icon">
                  <img src="{{ feature1Icon }}" width="{{ iconSize }}" style="display: block; border: 0; margin: {{ iconMargin }};" alt="" />
                </if>
                <p style="font-family: {{ font }}; font-size: {{ featureTitleSize }}; font-weight: {{ featureTitleWeight }}; color: {{ variant === 'image' ? imageTextColor : textColor }}; margin: 0;{{ feature1Desc ? ' margin-bottom: 6px;' : '' }}">
                  {{ feature1 }}
                </p>
                <if condition="feature1Desc">
                  <p style="font-family: {{ font }}; font-size: {{ featureDescSize }}; font-weight: {{ featureDescWeight }}; color: {{ variant === 'image' ? imageDescColor : textColor }}; margin: 0; line-height: {{ featureDescLineHeight }};{{ variant === 'image' ? ' opacity: ' + featureDescOpacity + ';' : '' }}">
                    {{ feature1Desc }}
                  </p>
                </if>
              </td>
            </tr>
          </table>
        </td>
        <td width="50%" class="mobile-stack" style="padding: 0 0 {{ fullGap }} {{ halfGap }};" valign="top">
          <table class="loomi-feature-card" role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="background-color: {{ cardBgColor }}; border-radius: {{ cardRadius }};{{ cardBorder ? ' border: ' + cardBorder + ';' : '' }}{{ variant === 'image' && feature2Image ? ' background-image: ' + imageOverlay + ', url(' + feature2Image + '); background-size: cover; background-position: center;' : '' }}{{ accentColor && variant === 'image' ? ' border-bottom: ' + accentWidth + ' solid ' + accentColor + ';' : '' }}">
            <tr>
              <td style="padding: {{ cardPadding }}; height: {{ cardHeight }}px;" valign="{{ variant === 'image' ? 'bottom' : 'top' }}">
                <if condition="feature2Icon">
                  <img src="{{ feature2Icon }}" width="{{ iconSize }}" style="display: block; border: 0; margin: {{ iconMargin }};" alt="" />
                </if>
                <p style="font-family: {{ font }}; font-size: {{ featureTitleSize }}; font-weight: {{ featureTitleWeight }}; color: {{ variant === 'image' ? imageTextColor : textColor }}; margin: 0;{{ feature2Desc ? ' margin-bottom: 6px;' : '' }}">
                  {{ feature2 }}
                </p>
                <if condition="feature2Desc">
                  <p style="font-family: {{ font }}; font-size: {{ featureDescSize }}; font-weight: {{ featureDescWeight }}; color: {{ variant === 'image' ? imageDescColor : textColor }}; margin: 0; line-height: {{ featureDescLineHeight }};{{ variant === 'image' ? ' opacity: ' + featureDescOpacity + ';' : '' }}">
                    {{ feature2Desc }}
                  </p>
                </if>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <!-- Row 2 (only rendered when feature 3 or 4 exist) -->
      <if condition="hasRow2">
        <tr>
          <td width="50%" class="mobile-stack" style="padding: 0 {{ halfGap }} 0 0;" valign="top">
            <if condition="hasFeature3">
              <table class="loomi-feature-card" role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="background-color: {{ cardBgColor }}; border-radius: {{ cardRadius }};{{ cardBorder ? ' border: ' + cardBorder + ';' : '' }}{{ variant === 'image' && feature3Image ? ' background-image: ' + imageOverlay + ', url(' + feature3Image + '); background-size: cover; background-position: center;' : '' }}{{ accentColor && variant === 'image' ? ' border-bottom: ' + accentWidth + ' solid ' + accentColor + ';' : '' }}">
                <tr>
                  <td style="padding: {{ cardPadding }}; height: {{ cardHeight }}px;" valign="{{ variant === 'image' ? 'bottom' : 'top' }}">
                    <if condition="feature3Icon">
                      <img src="{{ feature3Icon }}" width="{{ iconSize }}" style="display: block; border: 0; margin: {{ iconMargin }};" alt="" />
                    </if>
                    <p style="font-family: {{ font }}; font-size: {{ featureTitleSize }}; font-weight: {{ featureTitleWeight }}; color: {{ variant === 'image' ? imageTextColor : textColor }}; margin: 0;{{ feature3Desc ? ' margin-bottom: 6px;' : '' }}">
                      {{ feature3 }}
                    </p>
                    <if condition="feature3Desc">
                      <p style="font-family: {{ font }}; font-size: {{ featureDescSize }}; font-weight: {{ featureDescWeight }}; color: {{ variant === 'image' ? imageDescColor : textColor }}; margin: 0; line-height: {{ featureDescLineHeight }};{{ variant === 'image' ? ' opacity: ' + featureDescOpacity + ';' : '' }}">
                        {{ feature3Desc }}
                      </p>
                    </if>
                  </td>
                </tr>
              </table>
            </if>
          </td>
          <td width="50%" class="mobile-stack" style="padding: 0 0 0 {{ halfGap }};" valign="top">
            <if condition="hasFeature4">
              <table class="loomi-feature-card" role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="background-color: {{ cardBgColor }}; border-radius: {{ cardRadius }};{{ cardBorder ? ' border: ' + cardBorder + ';' : '' }}{{ variant === 'image' && feature4Image ? ' background-image: ' + imageOverlay + ', url(' + feature4Image + '); background-size: cover; background-position: center;' : '' }}{{ accentColor && variant === 'image' ? ' border-bottom: ' + accentWidth + ' solid ' + accentColor + ';' : '' }}">
                <tr>
                  <td style="padding: {{ cardPadding }}; height: {{ cardHeight }}px;" valign="{{ variant === 'image' ? 'bottom' : 'top' }}">
                    <if condition="feature4Icon">
                      <img src="{{ feature4Icon }}" width="{{ iconSize }}" style="display: block; border: 0; margin: {{ iconMargin }};" alt="" />
                    </if>
                    <p style="font-family: {{ font }}; font-size: {{ featureTitleSize }}; font-weight: {{ featureTitleWeight }}; color: {{ variant === 'image' ? imageTextColor : textColor }}; margin: 0;{{ feature4Desc ? ' margin-bottom: 6px;' : '' }}">
                      {{ feature4 }}
                    </p>
                    <if condition="feature4Desc">
                      <p style="font-family: {{ font }}; font-size: {{ featureDescSize }}; font-weight: {{ featureDescWeight }}; color: {{ variant === 'image' ? imageDescColor : textColor }}; margin: 0; line-height: {{ featureDescLineHeight }};{{ variant === 'image' ? ' opacity: ' + featureDescOpacity + ';' : '' }}">
                        {{ feature4Desc }}
                      </p>
                    </if>
                  </td>
                </tr>
              </table>
            </if>
          </td>
        </tr>
      </if>
    </table>
  </td>
</tr>
