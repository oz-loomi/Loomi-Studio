<script props>
  module.exports = {
    rooftop: props.rooftop || '',
    // Content
    buttonText: props['button-text'] || 'Schedule Service',
    buttonUrl: props['button-url'] || '{{custom_values.service_scheduler_url}}',
    // UTM
    utmSource: props['utm-source'] || 'email',
    utmMedium: props['utm-medium'] || 'lifecycle',
    utmCampaign: props['utm-campaign'] || 'service-reminder',
    utmContent: props['utm-content'] || '',
    utmTerm: props['utm-term'] || '',
    get fullUrl() {
      let url = this.buttonUrl;
      url += '?utm_source=' + this.utmSource;
      url += '&utm_medium=' + this.utmMedium;
      url += '&utm_campaign=' + this.utmCampaign;
      if (this.utmContent) url += '&utm_content=' + this.utmContent;
      if (this.utmTerm) url += '&utm_term=' + this.utmTerm;
      return url;
    },
    // Phone (PostHTML may coerce "false" to boolean false)
    showPhone: props['show-phone'] !== 'false' && props['show-phone'] !== false,
    phoneDisplay: (props['show-phone'] === 'false' || props['show-phone'] === false) ? 'none' : 'block',
    phoneText: props['phone-text'] || 'Or call your Service Advisor',
    // Layout
    align: props.align || 'center',
    sectionBgColor: props['section-bg-color'] || '',
    containerPadding: props['section-padding'] || '',
    // Typography
    font: props.font || "Helvetica Neue, Helvetica, Arial, sans-serif",
    // Button typography
    fontSize: props['button-font-size'] || '12px',
    fontWeight: props['button-font-weight'] || '700',
    letterSpacing: props['button-letter-spacing'] || '2px',
    textTransform: props['button-text-transform'] || 'uppercase',
    // Button style
    bgColor: props['button-bg-color'] || '#000000',
    textColor: props['button-text-color'] || '#ffffff',
    radius: props['button-radius'] || '0',
    padding: props['button-padding'] || '18px 48px',
    buttonBorderStyle: props['button-border-style'] || '',
    buttonBorderWidth: props['button-border-width'] || '',
    buttonBorderColor: props['button-border-color'] || '',
    border: props['button-border'] || '',
    get buttonBorderCss() {
      const style = this.buttonBorderStyle || (this.buttonBorderWidth || this.buttonBorderColor ? 'solid' : '');
      if (style === 'none') return '';
      if (style) {
        const width = this.buttonBorderWidth || '1px';
        const color = this.buttonBorderColor || this.textColor || '#ffffff';
        return ' border: ' + width + ' ' + style + ' ' + color + ';';
      }
      if (this.border) return ' border: ' + this.border + ';';
      return '';
    },
    // Phone typography
    phoneSize: props['phone-size'] || '13px',
    phoneWeight: props['phone-weight'] || '400',
    phoneMargin: props['phone-margin'] || '20px 0 0 0',
    phoneLinkWeight: props['phone-link-weight'] || '700',
    phoneColor: props['phone-color'] || '#666666',
    phoneLinkColor: props['phone-link-color'] || '#000000',
    // Section border
    sectionBorderColor: props['section-border-color'] || '',
    sectionBorderWidth: props['section-border-width'] || '0px',
    sectionBorderStyle: props['section-border-style'] || 'none',
    // Per-side section borders
    sectionBorderTopColor: props['section-border-top-color'] || '',
    sectionBorderTopWidth: props['section-border-top-width'] || '',
    sectionBorderTopStyle: props['section-border-top-style'] || '',
    sectionBorderRightColor: props['section-border-right-color'] || '',
    sectionBorderRightWidth: props['section-border-right-width'] || '',
    sectionBorderRightStyle: props['section-border-right-style'] || '',
    sectionBorderBottomColor: props['section-border-bottom-color'] || '',
    sectionBorderBottomWidth: props['section-border-bottom-width'] || '',
    sectionBorderBottomStyle: props['section-border-bottom-style'] || '',
    sectionBorderLeftColor: props['section-border-left-color'] || '',
    sectionBorderLeftWidth: props['section-border-left-width'] || '',
    sectionBorderLeftStyle: props['section-border-left-style'] || '',
    get sectionBorderCss() {
      const sides = [
        { s: 'top', c: this.sectionBorderTopColor, w: this.sectionBorderTopWidth, st: this.sectionBorderTopStyle },
        { s: 'right', c: this.sectionBorderRightColor, w: this.sectionBorderRightWidth, st: this.sectionBorderRightStyle },
        { s: 'bottom', c: this.sectionBorderBottomColor, w: this.sectionBorderBottomWidth, st: this.sectionBorderBottomStyle },
        { s: 'left', c: this.sectionBorderLeftColor, w: this.sectionBorderLeftWidth, st: this.sectionBorderLeftStyle },
      ];
      const perSide = sides.filter(x => x.c).map(x => ' border-' + x.s + ': ' + (x.w || this.sectionBorderWidth || '1px') + ' ' + (x.st || this.sectionBorderStyle || 'solid') + ' ' + x.c + ';').join('');
      if (perSide) return perSide;
      return this.sectionBorderColor ? ' border: ' + this.sectionBorderWidth + ' ' + this.sectionBorderStyle + ' ' + this.sectionBorderColor + ';' : '';
    },
    // ── Mobile overrides (responsive) ──
    mAlign: props['m:align'] || '',
    mSectionPadding: props['m:section-padding'] || '',
    mFontSize: props['m:button-font-size'] || '',
    mPadding: props['m:button-padding'] || '',
    mRadius: props['m:button-radius'] || '',
    mLetterSpacing: props['m:button-letter-spacing'] || '',
    scopeClass: 'loomi-c' + (props['component-index'] || '0'),
    get responsiveCss() {
      const r = [];
      const s = '.' + this.scopeClass + ' ';
      if (this.mAlign) r.push(s + '.loomi-cta-td { text-align: ' + this.mAlign + ' !important; }');
      if (this.mSectionPadding) r.push(s + '.loomi-cta-td { padding: ' + this.mSectionPadding + ' !important; }');
      if (this.mFontSize) r.push(s + '.loomi-btn { font-size: ' + this.mFontSize + ' !important; }');
      if (this.mPadding) r.push(s + '.loomi-btn { padding: ' + this.mPadding + ' !important; }');
      if (this.mRadius) r.push(s + '.loomi-btn { border-radius: ' + this.mRadius + ' !important; }');
      if (this.mLetterSpacing) r.push(s + '.loomi-btn { letter-spacing: ' + this.mLetterSpacing + ' !important; }');
      return r.join(' ');
    },
  };
</script>

<if condition="responsiveCss">
  <style>
    @media screen and (max-width: 600px) {
      {{{ responsiveCss }}}
    }
  </style>
</if>

<tr class="{{ scopeClass }}">
  <td class="mobile-padding loomi-cta-td" style="text-align: {{ align }};{{ sectionBgColor ? ' background-color: ' + sectionBgColor + ';' : '' }}{{ containerPadding ? ' padding: ' + containerPadding + ';' : '' }}{{ sectionBorderCss }}">
    <a
      href="{{ fullUrl }}"
      target="_blank"
      class="mobile-full-width loomi-btn"
      style="display: inline-block; background-color: {{ bgColor }}; border-radius: {{ radius }}; color: {{ textColor }}; font-family: {{ font }}; font-size: {{ fontSize }}; font-weight: {{ fontWeight }}; letter-spacing: {{ letterSpacing }}; text-decoration: none; text-transform: {{ textTransform }}; padding: {{ padding }};{{ buttonBorderCss }}"
    >
      {{ buttonText }}
    </a>
    <p style="display: {{ phoneDisplay }}; font-family: {{ font }}; font-size: {{ phoneSize }}; font-weight: {{ phoneWeight }}; color: {{ phoneColor }}; margin: {{ phoneMargin }};">
        {{ phoneText }}
        <a href="tel:{{location.phone}}" style="color: {{ phoneLinkColor }}; text-decoration: none; font-weight: {{ phoneLinkWeight }};">
          {{location.phone}}
        </a>
      </p>
  </td>
</tr>
