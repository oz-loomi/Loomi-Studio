<script props>
  module.exports = {
    rooftop: props.rooftop || '',
    // Content
    eyebrow: props.eyebrow || '',
    headline: props.headline || '',
    subheadline: props.subheadline || '',
    // Background
    bgImage: props['bg-image'] || '',
    bgSize: props['bg-size'] || 'cover',
    bgPosition: props['bg-position'] || 'center center',
    heroHeight: props['hero-height'] || '500px',
    fallbackBg: props['fallback-bg'] || '#1a1a1a',
    gradient: props.gradient || '',
    // Structured gradient
    gradientType: props['gradient-type'] || 'none',
    gradientAngle: props['gradient-angle'] || '',
    gradientDirection: props['gradient-direction'] || 'to bottom',
    gradientStart: props['gradient-start'] || '',
    gradientStartPosition: props['gradient-start-position'] || '0',
    gradientEnd: props['gradient-end'] || '',
    gradientEndPosition: props['gradient-end-position'] || '100',
    overlayOpacity: props['overlay-opacity'] || '0',
    get overlayAlpha() {
      const n = parseFloat(this.overlayOpacity);
      if (isNaN(n) || n <= 0) return 0;
      if (n >= 100) return 1;
      return n / 100;
    },
    get gradientValue() {
      if (this.gradientType === 'none' || !this.gradientStart || !this.gradientEnd) return '';
      const startPos = this.gradientStartPosition === '' ? '0' : this.gradientStartPosition;
      const endPos = this.gradientEndPosition === '' ? '100' : this.gradientEndPosition;
      const startStop = this.gradientStart + ' ' + startPos + '%';
      const endStop = this.gradientEnd + ' ' + endPos + '%';
      if (this.gradientType === 'radial') return 'radial-gradient(circle, ' + startStop + ', ' + endStop + ')';
      const axis = this.gradientAngle !== '' ? (this.gradientAngle + 'deg') : this.gradientDirection;
      return 'linear-gradient(' + axis + ', ' + startStop + ', ' + endStop + ')';
    },
    get overlayStyle() {
      const layers = [];
      if (this.overlayAlpha > 0) {
        const a = this.overlayAlpha;
        layers.push('linear-gradient(rgba(0,0,0,' + a + '), rgba(0,0,0,' + a + '))');
      }
      if (this.gradientValue) {
        layers.push(this.gradientValue);
      } else if (this.gradient) {
        layers.push(this.gradient);
      }
      if (layers.length > 0) return 'background: ' + layers.join(', ') + ';';
      return '';
    },
    // Layout
    textAlign: props['text-align'] || 'left',
    contentPadding: props['content-padding'] || '48px',
    contentValign: props['content-valign'] || 'bottom',
    // Primary button
    primaryButtonText: props['primary-button-text'] || '',
    primaryButtonUrl: props['primary-button-url'] || '{{custom_values.website_url}}',
    primaryButtonBgColor: props['primary-button-bg-color'] || '#ffffff',
    primaryButtonTextColor: props['primary-button-text-color'] || '#000000',
    primaryButtonRadius: props['primary-button-radius'] || '0',
    primaryButtonPadding: props['primary-button-padding'] || '16px 36px',
    primaryButtonBorderStyle: props['primary-button-border-style'] || '',
    primaryButtonBorderWidth: props['primary-button-border-width'] || '',
    primaryButtonBorderColor: props['primary-button-border-color'] || '',
    primaryButtonBorder: props['primary-button-border'] || '',
    get primaryButtonBorderCss() {
      const style = this.primaryButtonBorderStyle || (this.primaryButtonBorderWidth || this.primaryButtonBorderColor ? 'solid' : '');
      if (style === 'none') return '';
      if (style) {
        const width = this.primaryButtonBorderWidth || '1px';
        const color = this.primaryButtonBorderColor || this.primaryButtonTextColor || '#000000';
        return ' border: ' + width + ' ' + style + ' ' + color + ';';
      }
      if (this.primaryButtonBorder) return ' border: ' + this.primaryButtonBorder + ';';
      return '';
    },
    primaryButtonFontSize: props['primary-button-font-size'] || '12px',
    primaryButtonFontWeight: props['primary-button-font-weight'] || '700',
    primaryButtonLetterSpacing: props['primary-button-letter-spacing'] || '2px',
    primaryButtonTextTransform: props['primary-button-text-transform'] || 'uppercase',
    // Button gap
    buttonGap: props['button-gap'] || '12px',
    // Secondary button
    secondaryButtonText: props['secondary-button-text'] || '',
    secondaryButtonUrl: props['secondary-button-url'] || '{{custom_values.website_url}}',
    secondaryButtonBgColor: props['secondary-button-bg-color'] || 'transparent',
    secondaryButtonTextColor: props['secondary-button-text-color'] || '#ffffff',
    secondaryButtonRadius: props['secondary-button-radius'] || '0',
    secondaryButtonPadding: props['secondary-button-padding'] || '16px 36px',
    secondaryButtonBorderStyle: props['secondary-button-border-style'] || '',
    secondaryButtonBorderWidth: props['secondary-button-border-width'] || '',
    secondaryButtonBorderColor: props['secondary-button-border-color'] || '',
    secondaryButtonBorder: props['secondary-button-border'] || '1px solid #ffffff',
    get secondaryButtonBorderCss() {
      const style = this.secondaryButtonBorderStyle || (this.secondaryButtonBorderWidth || this.secondaryButtonBorderColor ? 'solid' : '');
      if (style === 'none') return '';
      if (style) {
        const width = this.secondaryButtonBorderWidth || '1px';
        const color = this.secondaryButtonBorderColor || this.secondaryButtonTextColor || '#ffffff';
        return ' border: ' + width + ' ' + style + ' ' + color + ';';
      }
      if (this.secondaryButtonBorder) return ' border: ' + this.secondaryButtonBorder + ';';
      return '';
    },
    secondaryButtonFontSize: props['secondary-button-font-size'] || '12px',
    secondaryButtonFontWeight: props['secondary-button-font-weight'] || '700',
    secondaryButtonLetterSpacing: props['secondary-button-letter-spacing'] || '2px',
    secondaryButtonTextTransform: props['secondary-button-text-transform'] || 'uppercase',
    // UTM Tracking
    utmSource: props['utm-source'] || 'email',
    utmMedium: props['utm-medium'] || 'lifecycle',
    utmCampaign: props['utm-campaign'] || '',
    utmContent: props['utm-content'] || '',
    utmTerm: props['utm-term'] || '',
    secondaryUtmSource: props['secondary-utm-source'] || '',
    secondaryUtmMedium: props['secondary-utm-medium'] || '',
    secondaryUtmCampaign: props['secondary-utm-campaign'] || '',
    secondaryUtmContent: props['secondary-utm-content'] || '',
    secondaryUtmTerm: props['secondary-utm-term'] || '',
    get fullPrimaryUrl() {
      let url = this.primaryButtonUrl;
      const params = [];
      if (this.utmSource) params.push('utm_source=' + this.utmSource);
      if (this.utmMedium) params.push('utm_medium=' + this.utmMedium);
      if (this.utmCampaign) params.push('utm_campaign=' + this.utmCampaign);
      if (this.utmContent) params.push('utm_content=' + this.utmContent);
      if (this.utmTerm) params.push('utm_term=' + this.utmTerm);
      if (params.length) url += (url.includes('?') ? '&' : '?') + params.join('&');
      return url;
    },
    get fullSecondaryUrl() {
      let url = this.secondaryButtonUrl;
      const params = [];
      if (this.secondaryUtmSource) params.push('utm_source=' + this.secondaryUtmSource);
      if (this.secondaryUtmMedium) params.push('utm_medium=' + this.secondaryUtmMedium);
      if (this.secondaryUtmCampaign) params.push('utm_campaign=' + this.secondaryUtmCampaign);
      if (this.secondaryUtmContent) params.push('utm_content=' + this.secondaryUtmContent);
      if (this.secondaryUtmTerm) params.push('utm_term=' + this.secondaryUtmTerm);
      if (params.length) url += (url.includes('?') ? '&' : '?') + params.join('&');
      return url;
    },
    // Typography
    font: props.font || "Helvetica Neue, Helvetica, Arial, sans-serif",
    eyebrowSize: props['eyebrow-size'] || '11px',
    eyebrowWeight: props['eyebrow-weight'] || '600',
    eyebrowSpacing: props['eyebrow-spacing'] || '3px',
    eyebrowTransform: props['eyebrow-transform'] || 'uppercase',
    eyebrowMargin: props['eyebrow-margin'] || '0 0 12px 0',
    headlineSize: props['headline-size'] || '32px',
    headlineWeight: props['headline-weight'] || '700',
    headlineSpacing: props['headline-spacing'] || 'normal',
    headlineTransform: props['headline-transform'] || 'none',
    headlineLineHeight: props['headline-line-height'] || '1.2',
    headlineMargin: props['headline-margin'] || '0 0 12px 0',
    subheadlineSize: props['subheadline-size'] || '15px',
    subheadlineWeight: props['subheadline-weight'] || '400',
    subheadlineLineHeight: props['subheadline-line-height'] || '1.6',
    subheadlineMargin: props['subheadline-margin'] || '0 0 28px 0',
    eyebrowColor: props['eyebrow-color'] || 'rgba(255,255,255,0.7)',
    headlineColor: props['headline-color'] || '#ffffff',
    subheadlineColor: props['subheadline-color'] || 'rgba(255,255,255,0.85)',
    // Border
    borderColor: props['border-color'] || '',
    borderWidth: props['border-width'] || '0px',
    borderStyle: props['border-style'] || 'none',
    borderTopColor: props['border-top-color'] || '',
    borderTopWidth: props['border-top-width'] || '',
    borderTopStyle: props['border-top-style'] || '',
    borderRightColor: props['border-right-color'] || '',
    borderRightWidth: props['border-right-width'] || '',
    borderRightStyle: props['border-right-style'] || '',
    borderBottomColor: props['border-bottom-color'] || '',
    borderBottomWidth: props['border-bottom-width'] || '',
    borderBottomStyle: props['border-bottom-style'] || '',
    borderLeftColor: props['border-left-color'] || '',
    borderLeftWidth: props['border-left-width'] || '',
    borderLeftStyle: props['border-left-style'] || '',
    borderRadius: props['border-radius'] || '',
    get borderCss() {
      const sides = [
        { s: 'top', c: this.borderTopColor, w: this.borderTopWidth, st: this.borderTopStyle },
        { s: 'right', c: this.borderRightColor, w: this.borderRightWidth, st: this.borderRightStyle },
        { s: 'bottom', c: this.borderBottomColor, w: this.borderBottomWidth, st: this.borderBottomStyle },
        { s: 'left', c: this.borderLeftColor, w: this.borderLeftWidth, st: this.borderLeftStyle },
      ];
      const perSide = sides.filter(x => x.c).map(x => ' border-' + x.s + ': ' + (x.w || this.borderWidth || '1px') + ' ' + (x.st || this.borderStyle || 'solid') + ' ' + x.c + ';').join('');
      if (perSide) return perSide;
      return this.borderColor ? ' border: ' + this.borderWidth + ' ' + this.borderStyle + ' ' + this.borderColor + ';' : '';
    },
    // ── Mobile overrides (responsive) ──
    mEyebrowSize: props['m:eyebrow-size'] || '',
    mHeadlineSize: props['m:headline-size'] || '',
    mSubheadlineSize: props['m:subheadline-size'] || '',
    mHeroHeight: props['m:hero-height'] || '',
    mContentPadding: props['m:content-padding'] || '',
    mTextAlign: props['m:text-align'] || '',
    mContentValign: props['m:content-valign'] || '',
    mPrimaryButtonFontSize: props['m:primary-button-font-size'] || '',
    mPrimaryButtonPadding: props['m:primary-button-padding'] || '',
    mPrimaryButtonRadius: props['m:primary-button-radius'] || '',
    mPrimaryButtonLetterSpacing: props['m:primary-button-letter-spacing'] || '',
    mSecondaryButtonFontSize: props['m:secondary-button-font-size'] || '',
    mSecondaryButtonPadding: props['m:secondary-button-padding'] || '',
    mSecondaryButtonRadius: props['m:secondary-button-radius'] || '',
    mSecondaryButtonLetterSpacing: props['m:secondary-button-letter-spacing'] || '',
    mButtonGap: props['m:button-gap'] || '',
    mBorderRadius: props['m:border-radius'] || '',
    scopeClass: 'loomi-c' + (props['component-index'] || '0'),
    get responsiveCss() {
      const r = [];
      const s = '.' + this.scopeClass + ' ';
      const mobileButtonGap = this.mButtonGap || this.buttonGap || '12px';
      // Mobile-safe defaults so desktop-heavy hero settings don't overflow in narrow previews.
      r.push(s + '.loomi-headline, ' + s + '.loomi-subheadline { overflow-wrap: anywhere !important; word-break: break-word !important; }');
      // Keep these unscoped so mobile full-width still works even if scope class/index drifts.
      r.push('.loomi-btn-table { width: 100% !important; max-width: 100% !important; }');
      r.push('.loomi-btn-cell { display: block !important; width: 100% !important; }');
      r.push('.loomi-btn-primary, .loomi-btn-secondary { display: block !important; width: 100% !important; max-width: 100% !important; box-sizing: border-box !important; text-align: center !important; }');
      r.push('.loomi-btn-primary { margin-right: 0 !important; }');
      r.push('.loomi-btn-secondary { margin-top: ' + mobileButtonGap + ' !important; }');
      if (!this.mContentPadding) r.push(s + '.loomi-content { padding: 24px !important; }');
      if (!this.mHeadlineSize) r.push(s + '.loomi-headline { font-size: 32px !important; }');
      if (!this.mSubheadlineSize) r.push(s + '.loomi-subheadline { font-size: 14px !important; }');
      if (this.mEyebrowSize) r.push(s + '.loomi-eyebrow { font-size: ' + this.mEyebrowSize + ' !important; }');
      if (this.mHeadlineSize) r.push(s + '.loomi-headline { font-size: ' + this.mHeadlineSize + ' !important; }');
      if (this.mSubheadlineSize) r.push(s + '.loomi-subheadline { font-size: ' + this.mSubheadlineSize + ' !important; }');
      if (this.mHeroHeight) r.push(s + '.loomi-hero-td { height: ' + this.mHeroHeight + ' !important; }');
      if (this.mContentPadding) r.push(s + '.loomi-content { padding: ' + this.mContentPadding + ' !important; }');
      if (this.mTextAlign) r.push(s + '.loomi-text-cell { text-align: ' + this.mTextAlign + ' !important; }');
      if (this.mPrimaryButtonFontSize) r.push(s + '.loomi-btn-primary { font-size: ' + this.mPrimaryButtonFontSize + ' !important; }');
      if (this.mPrimaryButtonPadding) r.push(s + '.loomi-btn-primary { padding: ' + this.mPrimaryButtonPadding + ' !important; }');
      if (this.mPrimaryButtonRadius) r.push(s + '.loomi-btn-primary { border-radius: ' + this.mPrimaryButtonRadius + ' !important; }');
      if (this.mPrimaryButtonLetterSpacing) r.push(s + '.loomi-btn-primary { letter-spacing: ' + this.mPrimaryButtonLetterSpacing + ' !important; }');
      if (this.mSecondaryButtonFontSize) r.push(s + '.loomi-btn-secondary { font-size: ' + this.mSecondaryButtonFontSize + ' !important; }');
      if (this.mSecondaryButtonPadding) r.push(s + '.loomi-btn-secondary { padding: ' + this.mSecondaryButtonPadding + ' !important; }');
      if (this.mSecondaryButtonRadius) r.push(s + '.loomi-btn-secondary { border-radius: ' + this.mSecondaryButtonRadius + ' !important; }');
      if (this.mSecondaryButtonLetterSpacing) r.push(s + '.loomi-btn-secondary { letter-spacing: ' + this.mSecondaryButtonLetterSpacing + ' !important; }');
      if (this.mBorderRadius) r.push(s + '.loomi-hero-td { border-radius: ' + this.mBorderRadius + ' !important; overflow: hidden !important; }');
      return r.join(' ');
    },
  };
</script>

<if condition="responsiveCss">
  <style>
    @media screen and (max-width: 600px) {
      {{{ responsiveCss }}}
    }
  </style>
</if>

<!--[if mso]>
<v:rect xmlns:v="urn:schemas-microsoft-com:vml" fill="true" stroke="false" style="width:600px;height:{{ heroHeight }};">
<v:fill type="frame" src="{{ bgImage }}" />
<v:textbox inset="0,0,0,0">
<![endif]-->
<tr class="{{ scopeClass }}">
  <td
    class="loomi-hero-td"
    background="{{ bgImage }}"
    bgcolor="{{ fallbackBg }}"
    height="{{ heroHeight }}"
    valign="{{ contentValign }}"
    style="width: 100%; background-image: url('{{ bgImage }}'); background-size: {{ bgSize }}; background-position: {{ bgPosition }}; height: {{ heroHeight }};{{ borderCss }}{{ borderRadius ? ' border-radius: ' + borderRadius + '; overflow: hidden;' : '' }}"
  >
    <div class="loomi-content" style="{{ overlayStyle }} padding: {{ contentPadding }}; height: 100%; box-sizing: border-box;" valign="{{ contentValign }}">
      <!--[if mso]>
      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0">
        <tr>
          <td valign="{{ contentValign }}" style="padding: 0;">
      <![endif]-->
      <table role="presentation" width="100%" cellspacing="0" cellpadding="0" border="0" style="height: 100%;">
        <tr>
          <td class="loomi-text-cell" valign="{{ contentValign }}" style="text-align: {{ textAlign }};">
            <if condition="eyebrow">
              <p class="loomi-eyebrow" style="font-family: {{ font }}; font-size: {{ eyebrowSize }}; font-weight: {{ eyebrowWeight }}; letter-spacing: {{ eyebrowSpacing }}; text-transform: {{ eyebrowTransform }}; color: {{ eyebrowColor }}; margin: {{ eyebrowMargin }};">
                {{ eyebrow }}
              </p>
            </if>
            <if condition="headline">
              <h1 class="loomi-headline" style="font-family: {{ font }}; font-size: {{ headlineSize }}; font-weight: {{ headlineWeight }}; letter-spacing: {{ headlineSpacing }}; text-transform: {{ headlineTransform }}; line-height: {{ headlineLineHeight }}; color: {{ headlineColor }}; margin: {{ headlineMargin }};">
                {{{ headline }}}
              </h1>
            </if>
            <if condition="subheadline">
              <p class="loomi-subheadline" style="font-family: {{ font }}; font-size: {{ subheadlineSize }}; font-weight: {{ subheadlineWeight }}; line-height: {{ subheadlineLineHeight }}; color: {{ subheadlineColor }}; margin: {{ subheadlineMargin }};">
                {{ subheadline }}
              </p>
            </if>
            <if condition="primaryButtonText">
              <table class="loomi-btn-table" role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="width: 100%;{{ textAlign === 'center' ? ' text-align: center;' : '' }}">
                <tr>
                  <td class="loomi-btn-cell" style="font-size: 0; line-height: 0; text-align: {{ textAlign }};">
                    <a
                      class="loomi-btn-primary mobile-full-width"
                      href="{{ fullPrimaryUrl }}"
                      target="_blank"
                      style="display: inline-block; background-color: {{ primaryButtonBgColor }}; border-radius: {{ primaryButtonRadius }}; color: {{ primaryButtonTextColor }}; font-family: {{ font }}; font-size: {{ primaryButtonFontSize }}; font-weight: {{ primaryButtonFontWeight }}; letter-spacing: {{ primaryButtonLetterSpacing }}; text-decoration: none; text-transform: {{ primaryButtonTextTransform }}; padding: {{ primaryButtonPadding }}; line-height: normal;{{ secondaryButtonText ? ' margin-right: ' + buttonGap + ';' : '' }}{{ primaryButtonBorderCss }}"
                    >
                      {{ primaryButtonText }}
                    </a>
                    <if condition="secondaryButtonText">
                      <a
                        class="loomi-btn-secondary mobile-full-width"
                        href="{{ fullSecondaryUrl }}"
                        target="_blank"
                        style="display: inline-block; background-color: {{ secondaryButtonBgColor }}; border-radius: {{ secondaryButtonRadius }}; color: {{ secondaryButtonTextColor }}; font-family: {{ font }}; font-size: {{ secondaryButtonFontSize }}; font-weight: {{ secondaryButtonFontWeight }}; letter-spacing: {{ secondaryButtonLetterSpacing }}; text-decoration: none; text-transform: {{ secondaryButtonTextTransform }}; padding: {{ secondaryButtonPadding }}; line-height: normal;{{ secondaryButtonBorderCss }}"
                      >
                        {{ secondaryButtonText }}
                      </a>
                    </if>
                  </td>
                </tr>
              </table>
            </if>
          </td>
        </tr>
      </table>
      <!--[if mso]>
          </td>
        </tr>
      </table>
      <![endif]-->
    </div>
  </td>
</tr>
<!--[if mso]>
</v:textbox>
</v:rect>
<![endif]-->
